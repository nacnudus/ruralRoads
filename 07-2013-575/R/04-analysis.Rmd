```{r include = FALSE}
source("01-function.r")
```

Rural Drink-Driving in the Bay of Plenty
========================================

All the crashes discussed in this document are fatal/serious-injury crashes.


## Numbers of Crashes

Rural areas tend to have slightly more crashes than urban areas, both alcohol-related and otherwise, although non-alcohol crashes in urban areas increased in during 2011 and 2012 to meet rural levels.

Alcohol crashes are declining in both urban and rural areas.

```{r fig.width=7, fig.height=6}
ggplot(crashes, aes(year, group = urbanRural, fill = urbanRural)) + 
 geom_bar(binwidth = 1, position = "dodge") + facet_wrap(.(alcohol))
```

#```{r fig.width=7, fig.height=6}
#ggplot(crashes, aes(alcohol, group = urbanRural, fill = urbanRural)) + 
# geom_bar(binwidth = 1, position = "dodge")
#```


## Crash rate per 1000 km of road

Roads have been divided into four categories, according to the type of road they are, and the area they are in.

* urban roads (excluding highways)
* urban highways
* rural roads (excluding highways)
* rural highways

### Road in the Bay of Plenty (km)

# ```{r}
# print(xtable(SummaryBoP[c("urban", "rural"), c("road", "highway")]), type = "html")
# ```

# urban highways have by far the worst fatal/serious crash
# rate.
ggplot(crashes, aes(year, weight = countRoad, group = urbanRuralRoadHighway, fill = urbanRuralRoadHighway)) + 
  geom_bar(position = "dodge")
# This probably reflects the amount of traffic at peak times, given the hourly
# profile.
ggplot(crashes[!is.na(crashes$hour & crashes$urbanRuralRoadHighway == "urban highway"), ]
       , aes(hour)) + 
  geom_bar(binwidth = 1, position = "dodge", fill = "grey") +
  geom_density() + 
  aes(y = ..count..) +
  scale_x_continuous(breaks = seq(0,24,4))
# However, that cannot be the whole story, or the crash rate on rural highways
# would be lower, because traffic volumes are lower.
ggplot(crashes[!is.na(crashes$hour && crashes$stateHighway == "highway"), ]
       , aes(hour)) + 
  geom_bar(binwidth = 1, position = "dodge", fill = "grey") +
  geom_density() + 
  aes(y = ..count..) +
  scale_x_continuous(breaks = seq(0,24,4)) +
  facet_wrap(.(urbanRural))

# crashes by population
ggplot(crashes, aes(year, weight = countPopulation, group = urbanRural, fill = urbanRural)) + 
  geom_bar(position = "dodge") + facet_wrap(.(alcohol))


